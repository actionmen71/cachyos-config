#!/usr/bin/env bash

# File to store the last known public IP
LAST_IP_FILE="$HOME/.config/waybar/scripts/.last_public_ip"

# Get current public IP
CURRENT_IP=$(curl -s https://api.ipify.org)

# Read the last IP from file
if [[ -f "$LAST_IP_FILE" ]]; then
    LAST_IP=$(cat "$LAST_IP_FILE")
else
    LAST_IP="$CURRENT_IP"
    echo "$CURRENT_IP" > "$LAST_IP_FILE"
fi

# Decide VPN status
if [[ "$CURRENT_IP" != "$LAST_IP" ]]; then
    STATUS="connected"
else
    STATUS="disconnected"
fi

# Save current IP for next check
echo "$CURRENT_IP" > "$LAST_IP_FILE"

# Output for Waybar
if [[ "$STATUS" == "connected" ]]; then
    echo "{\"text\": \"ï”‘\", \"class\": \"connected\"}"
fi
